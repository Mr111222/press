<template lang="pug">
  .contain(ref="contain" :style="styles")
    ul
      li(:style="liStyles" v-for="item in [1,2,3,4]" v-if="item <= blankRow")
      li(:style="liStyles" v-for="(item,index) in datas") {{item.label}}
      li(:style="liStyles" v-for="item in [1,2,3,4]" v-if="item <= blankRow")
</template>
<script>
  import Scroller from '../lib/scroller'
  export default {
    props: {
      datas: {
        type: Array,
        required: true
      },
      selected: {
        type: Number,
        required: true
      },
      blankRow: {
        type: Number,
        default: 0
      },
      lineHeight: Number,
      styles: Object,
      target: Number
    },
    data () {
      return {
        slelctedData: {},
        scrollObj: null
      }
    },
    computed: {
      liStyles () {
        if (this.lineHeight) {
          return {
            'height': this.lineHeight + 'px',
            'line-height': this.lineHeight + 'px'
          }
        }
      },
      selectOrder () {
        const maxOrder = this.datas.length - 1
        if (this.selected > maxOrder) {
          var backData = {
            target: this.target,
            order: maxOrder,
            value: this.datas[maxOrder]
          }
          this.$emit('change', backData)
          return this.datas.length - 1
        } else {
          return this.selected
        }
      }
    },
    mounted () {
      let lineHeight = 35
      if (this.lineHeight) lineHeight = this.lineHeight
      this.scrollObj = new Scroller(
        this.$refs.contain,
        {
          blankRow: this.blankRow,
          selected: this.selectOrder,
          lineHeight
        },
        this.setValue.bind(this)
      )
      window['scroll_' + this.target] = this.scrollObj
    },
    updated () {
      this.scrollObj.refresh()
      this.scrollObj.scrollTo(this.selectOrder)
    },
    methods: {
      setValue (index) {
        const backData = {
          target: this.target,
          order: index,
          value: this.datas[index]
        }
        this.$emit('change', backData)
      }
    }
  }
</script>
